{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="p-3">
  <div class="container">
    <a href="{% url 'job_list' %}" class="btn btn-link ps-0">← Back to jobs</a>

    <div class="row mt-2">
      <div class="col-lg-8">
        <div class="card p-3">
          <h2 class="mb-1">{{ job.title }}</h2>
          <div class="mb-2 text-muted">
            {{ job.location }} • {{ job.get_job_type_display }}
          </div>

          <div class="mb-3">
            <span class="badge {% if job.visa_sponsorship == 'YES' %}bg-success{% else %}bg-dark{% endif %}">
              {{ job.get_visa_sponsorship_display }}
            </span>
          </div>

          {% if job.salary_min or job.salary_max %}
            <p><strong>Salary Range:</strong>
              ${{ job.salary_min|default:"?" }} – ${{ job.salary_max|default:"?" }}
            </p>
          {% endif %}

          <hr>
          <h5>Required Skills</h5>
          <p class="mb-0">
            {% if job.skills %}
              <!-- display comma-separated skills as chips -->
              {% for s in job.skill_list %}
                <span class="badge bg-secondary me-1">{{ s }}</span>
              {% endfor %}
            {% else %}
              <em>Not specified.</em>
            {% endif %}
          </p>
        </div>
      </div>

      <div class="col-lg-4 mt-3 mt-lg-0">
        <div class="card p-3">
          <h6 class="mb-2">Quick Apply</h6>
          <ul class="list-unstyled mb-0 small">
            <li><strong>Job ID:</strong> {{ job.id }}</li>
            <li><strong>Posted:</strong> {{ job.created_at|date:"M j, Y" }}</li>
            <li><strong>Updated:</strong> {{ job.updated_at|date:"M j, Y" }}</li>

            {% if user.is_authenticated and application %}
              <li>
                <strong>Application Status:</strong>
                <span class="badge
                  {% if application.status == 'applied' %} bg-secondary
                  {% elif application.status == 'review' %} bg-info text-dark
                  {% elif application.status == 'interview' %} bg-warning text-dark
                  {% elif application.status == 'offer' %} bg-success
                  {% elif application.status == 'closed' %} bg-danger
                  {% else %} bg-dark
                  {% endif %}
                ">
                  {{ application.get_status_display }}
                </span>
              </li>
            {% endif %}
          </ul>

          <div class="mt-3">
            {% if user.is_authenticated %}
              {% if application %}
                {% if application.note %}
                  <div class="mb-2">
                    <strong>Your Note:</strong>
                    <div class="border rounded p-2 bg-light">
                      {{ application.note }}
                    </div>
                  </div>
                {% endif %}
                <div class="alert alert-warning mt-3">
                  You already applied to this job.
                </div>
              {% else %}
                <form method="post" action="{% url 'apply_to_job' job.id %}">
                  {% csrf_token %}
                  <textarea name="note" class="form-control mb-2" rows="3" placeholder="Write a short note..."></textarea>
                  <button type="submit" class="btn bg-dark text-white">Apply</button>
                </form>
              {% endif %}
            {% else %}
              <a href="{% url 'accounts.login' %}" class="btn bg-dark text-white">Log in to apply</a>
            {% endif %}
          </div>
        </div>

      </div>
    </div>

  </div>
</div>
{% endblock content %}